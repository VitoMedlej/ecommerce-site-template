import type {Metadata}
from "next";
import "./globals.css";
import Footer from "@/Components/Footer/Footer";
import Navbar from "@/Components/Navbar/Navbar";
import SideBar from "@/Components/SideBar/SideBar";
import QuickCart from "@/Components/QuickCart/QuickCart";
import PerksSection from "@/Components/PerksSection/PerksSection";
import {client} from "@/Utils/functions/sanityClient";
import ContextWrapper from "@/Utils/Context/Contexts";
import Script from "next/script";

export const metadata : Metadata = {
    title: "Create Next App",
    description: "Generated by create next app"
};

export async function fetchCategories(revalidate?: number) {
    const categories = await client.fetch(`*[_type == "category"] {
      title,
      subcategories
    }`, {}, {
        cache: "force-cache",
        next: {
            revalidate
        }
    });
    return categories;
}

export async function fetchAnnouncements(revalidate?: number) {
    const announcements = await client.fetch(`*[_type == "announcement"] {
      message
    }`, {}, {
        cache: "force-cache",
        next: {
            revalidate
        }
    });
    return announcements;
}

export default async function RootLayout({children} : {
    children: React.ReactNode
}) {
    const categories = await fetchCategories(2000);
    const announcements = await fetchAnnouncements(2000);
    return (
        <html lang="en">
            <head>
            <link rel="preconnect" href="https://fonts.gstatic.com"  />
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;600;800&display=swap" as="style" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;600;800&display=swap" />



<Script
        id="crisp-chat"
        strategy="afterInteractive"
        dangerouslySetInnerHTML={{
          __html: `
            window.$crisp=[];
            window.CRISP_WEBSITE_ID="abcabac";
            (function(){
              var d=document;
              var s=d.createElement("script");
              s.src="https://client.crisp.chat/l.js";
              s.async=1;
              d.getElementsByTagName("head")[0].appendChild(s);
            })();
          `,
        }}
      />

            </head>
            <body>
                <ContextWrapper SanityCategories={categories}>
                    <Navbar SanityAnnouncements={announcements}/>
                    <SideBar/>
                    <QuickCart/> {children}
                    <PerksSection/>
                    <Footer/>
                </ContextWrapper>
            </body>
        </html>
    );
}
